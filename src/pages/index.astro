---
import Layout from "@/layouts/Layout.astro";
import { getBlogs } from "@/lib/microcms";

const posts = await getBlogs({ fields: ["id", "title", "tags", "publishedAt", "createdAt"] });
---

<Layout>
	<div class="post-list">
		{
			posts.contents.map((post) => {
				const date = post.publishedAt !== undefined ? post.publishedAt : post.createdAt;

				return (
					<div class="post-wrap">
						<div class="post-head">
							<time class="post-date" datetime={date}>
								{date}
							</time>
							<div class="post-tags">
								{post.tags.map((tag) => (
									<span>#{tag.name}</span>
								))}
							</div>
						</div>
						<h2>{post.title}</h2>
						<a class="post-link" href={`/${post.id}`} />
					</div>
				);
			})
		}
	</div>
</Layout>

<style>
	.post-list {
		display: flex;
		flex-direction: column;
	}

	.post-wrap {
		display: table;
		position: relative;
	}

	.post-wrap:hover {
		text-decoration: underline;
	}

	.post-head {
		display: flex;
		gap: 10px;
		flex-wrap: wrap;
		align-items: flex-end;
	}

	.post-date {
		font-size: 15px;
	}

	.post-tags {
		display: flex;
		gap: 15px;
		flex-wrap: wrap;
		align-items: center;
	}

	.post-link {
		display: block;
		position: absolute;
		top: 0;
		left: 0;
		width: 100%;
		height: 100%;
	}
</style>
